<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libcmml: Example Documentation</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>cmml-parse.c</h1><b>Reading from a CMML file</b><p>
libcmml provides a convenient callback based framework for reading CMML files. After opening a CMML file for reading, you can attach various callbacks relevant to the parts of the file you are interested in, including the stream element, head element, and clip elements. Then, as bytes are read, libcmml will call your callbacks as appropriate.<p>
The functions that need to be called and the respective data structures are defined in <a class="el" href="cmml_8h.html">cmml.h</a>.<p>
The general sequence of API calls is the following:<p>
<ul>
<li>open a CMML object using <a class="el" href="cmml_8h.html#a37">cmml_open()</a> on a local file or <a class="el" href="cmml_8h.html#a38">cmml_new()</a> with a FILE pointer to an already opened file.</li><li>attach read callbacks using <a class="el" href="cmml_8h.html#a41">cmml_set_read_callbacks()</a></li><li>call <a class="el" href="cmml_8h.html#a42">cmml_read()</a> repeatedly until it returns 0 or -1.</li><li>close the CMML object with <a class="el" href="cmml_8h.html#a39">cmml_destroy()</a> returning the FILE pointer or use <a class="el" href="cmml_8h.html#a40">cmml_close()</a> to close both the object and the open file.</li></ul>
<p>
This procedure is illustrated in cmml-parse.c, which prints the title attribute of a CMML tag : <div class="fragment"><pre>
<span class="preprocessor">#include &lt;stdio.h&gt;</span>

<span class="preprocessor">#include &lt;<a class="code" href="cmml_8h.html">cmml.h</a>&gt;</span>

<span class="preprocessor">#define BUFSIZE 100000</span>
<span class="preprocessor"></span>

<span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="a0"></a><a class="code" href="cmml-validate_8c.html#a4">read_head</a> (<a class="code" href="cmml_8h.html#a0">CMML</a> * cmml, <span class="keyword">const</span> <a name="_a1"></a><a class="code" href="structCMML__Head.html">CMML_Head</a> * head, <span class="keywordtype">void</span> * user_data) {
  puts(head-&gt;<a name="a2"></a><a class="code" href="structCMML__Head.html#o4">title</a>);
  <span class="keywordflow">return</span> 0;
}

<span class="keywordtype">int</span> <a name="a3"></a><a class="code" href="cmml-validate_8c.html#a6">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
{
  <span class="keywordtype">char</span> *filename = NULL;
  FILE * cmml_file;
  <a class="code" href="cmml_8h.html#a0">CMML</a> * doc;
  <span class="keywordtype">long</span> n = 0;

  <span class="keywordflow">if</span> (argc != 2) {
    fprintf (stderr, <span class="stringliteral">"Usage: %s &lt;CMMLfile&gt;\n"</span>, argv[0]);
    exit (1);
  }
  filename = argv[1];
 
  cmml_file = fopen(filename, <span class="stringliteral">"r"</span>);
  doc = <a name="a4"></a><a class="code" href="cmml_8h.html#a38">cmml_new</a>(cmml_file);

  <span class="comment">/* alternatively use:</span>
<span class="comment">   *  doc = cmml_open(filename);</span>
<span class="comment">   */</span>

  <a name="a5"></a><a class="code" href="cmml_8h.html#a41">cmml_set_read_callbacks</a> (doc, NULL, read_head, NULL, NULL);

  <span class="keywordflow">while</span> (((n = <a name="a6"></a><a class="code" href="cmml_8h.html#a42">cmml_read</a> (doc, BUFSIZE)) &gt; 0));

  cmml_file = <a name="a7"></a><a class="code" href="cmml_8h.html#a39">cmml_destroy</a>(doc);
  fclose(cmml_file);
  
  <span class="comment">/* alternatively use:</span>
<span class="comment">   *  cmml_close(doc);</span>
<span class="comment">   */</span>

  exit(0);
}
</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Thu Mar 11 13:52:17 2004 for libcmml by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
