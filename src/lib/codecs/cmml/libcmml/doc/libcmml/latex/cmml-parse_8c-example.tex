\section{cmml-parse.c}
{\bf Reading from a CMML file}

libcmml provides a convenient callback based framework for reading CMML files. After opening a CMML file for reading, you can attach various callbacks relevant to the parts of the file you are interested in, including the stream element, head element, and clip elements. Then, as bytes are read, libcmml will call your callbacks as appropriate.

The functions that need to be called and the respective data structures are defined in {\bf cmml.h}{\rm (p.\,\pageref{cmml_8h})}.

The general sequence of API calls is the following:

\begin{itemize}
\item open a CMML object using {\bf cmml\_\-open()}{\rm (p.\,\pageref{cmml_8h_a37})} on a local file or {\bf cmml\_\-new()}{\rm (p.\,\pageref{cmml_8h_a38})} with a FILE pointer to an already opened file.\item attach read callbacks using {\bf cmml\_\-set\_\-read\_\-callbacks()}{\rm (p.\,\pageref{cmml_8h_a41})}\item call {\bf cmml\_\-read()}{\rm (p.\,\pageref{cmml_8h_a42})} repeatedly until it returns 0 or -1.\item close the CMML object with {\bf cmml\_\-destroy()}{\rm (p.\,\pageref{cmml_8h_a39})} returning the FILE pointer or use {\bf cmml\_\-close()}{\rm (p.\,\pageref{cmml_8h_a40})} to close both the object and the open file.\end{itemize}


This procedure is illustrated in cmml-parse.c, which prints the title attribute of a CMML tag : 

\footnotesize\begin{verbatim}
#include <stdio.h>

#include <cmml.h>

#define BUFSIZE 100000


static int
read_head (CMML * cmml, const CMML_Head * head, void * user_data) {
  puts(head->title);
  return 0;
}

int main(int argc, char *argv[])
{
  char *filename = NULL;
  FILE * cmml_file;
  CMML * doc;
  long n = 0;

  if (argc != 2) {
    fprintf (stderr, "Usage: %s <CMMLfile>\n", argv[0]);
    exit (1);
  }
  filename = argv[1];
 
  cmml_file = fopen(filename, "r");
  doc = cmml_new(cmml_file);

  /* alternatively use:
   *  doc = cmml_open(filename);
   */

  cmml_set_read_callbacks (doc, NULL, read_head, NULL, NULL);

  while (((n = cmml_read (doc, BUFSIZE)) > 0));

  cmml_file = cmml_destroy(doc);
  fclose(cmml_file);
  
  /* alternatively use:
   *  cmml_close(doc);
   */

  exit(0);
}
\end{verbatim}
\normalsize
 